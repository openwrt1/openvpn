name: Deploy to Server

# 当你向 main 分支推送代码时触发
on:
    push:
        branches:
            - main

jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            # 1. 检出你的代码
            - name: Checkout code
              uses: actions/checkout@v3

            # 2. 设置 SSH
            - name: Setup SSH
              uses: webfactory/ssh-agent@v0.7.0
              with:
                  ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
            
            # 3. 将文件复制到服务器
            - name: Copy file to server
              run: |
                  # 将你的服务器添加到已知主机，避免交互式提示
                  ssh-keyscan -H ${{ secrets.REMOTE_HOST }} >> ~/.ssh/known_hosts

                  # 使用 scp 命令复制文件
                  # 语法: scp <本地文件路径> <用户@主机:远程路径>
                  scp ./Openvpn.sh ${{ secrets.REMOTE_USER }}@${{ secrets.REMOTE_HOST }}:/root/openvpn-install.sh

                  echo "✅ Script deployed successfully!"

